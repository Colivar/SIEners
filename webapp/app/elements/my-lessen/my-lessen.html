<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/google-chart/google-chart.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">

<dom-module id="my-lessen">
    <template>
        <style>
            :host {
                display: block;
            }

            .collapse-content {
                 padding: 15px;
                 border: 1px solid #dedede;
             }

            span {
                @apply(--paper-font-body1);
            }

        </style>

        <h1 class="page-title">Overzicht van mijn vakken ( {{username}} )</h1>
        <table>
            <tr>
                <th>Datum</th>
                <th>Begintijd</th>
                <th>Eindtijd</th>
                <th>Docent</th>
                <th>Klas</th>
                <th>Lokaal</th>
                <th>Vak</th>
            </tr>
            <template is="dom-repeat" items="{{deLessen}}">
                <tr>
                    <td> {{item.datum}} </td>
                    <td> {{item.begintijd}} </td>
                    <td> {{item.eindtijd}} </td>
                    <td> {{item.docent}} </td>
                    <td> {{item.klas}} </td>
                    <td> {{item.lokaal}} </td>
                    <td> {{item.vak}} </td>
                    <td><paper-button raised on-click="">Select Grafiek</paper-button></td>

                </tr>
            </template>
        </table>
        <div id="chart"></div>
        <form><input id="b1" type="button" value="Change Value"/></form>


        <iron-ajax
            id="ajax"
            method="POST"
            url="/docent/mijnRooster"
            handle-as="json"
            on-response="responseHandler">
    </iron-ajax>

        <iron-ajax
                id="absentie"
                method="POST"
                url="/docent/mijnRooster"
                <!--^-hier komt de link naar de java functie die de gegevens ophaalt-->
                handle-as="json"
                on-response="responseHandler">
        </iron-ajax>

    </template>

    <script>

        (function () {
            'use strict';

            Polymer({
                is: 'my-lessen',

                properties: {
                    username: String,
                    rol: {
                        observer: 'fetchLessen'
                    }
                },

                responseHandler: function (request) {
                    console.log(request.detail.response);
                    this.deLessen = request.detail.response;
                    console.log(this.deLessen);
                },

                fetchLessen: function () {
                    console.log("FetchLessen user=" + this.username);
                    if (this.rol == "docent") {
                        this.$.ajax.contentType = "application/json";
                        this.$.ajax.body = {
                            "username": this.username
                        };
                        this.$.ajax.generateRequest();
                    }
                }


            });
        })();
        </script>
        <script>
        function drawChart() {

            // Create and populate the data table.
            var options = {
                title:"Yearly Coffee Consumption",
                width:600,
                height:400,
                animation: {duration: 1000, easing: 'out',},
                vAxis: {title: "Cups", minValue:0, maxValue:500},
                hAxis: {title: "Year"}
            };

            var data = new google.visualization.DataTable();
            data.addColumn('string', 'N');
            data.addColumn('number', 'Value');
            data.addRow(['2003', 0]);
            data.addRow(['2004', 0]);
            data.addRow(['2005', 0]);

            // Create and draw the visualization.
            var chart = new google.visualization.ColumnChart(document.getElementById('chart'));
            chart.draw(data, options);
            data.setValue(0, 1, 400);
            data.setValue(1, 1, 300);
            data.setValue(2, 1, 400);
            chart.draw(data, options);

            var button = document.getElementById('b1');
            button.onclick = function() {

                if (data.getNumberOfRows() > 5) {
                    data.removeRow(Math.floor(Math.random() * data.getNumberOfRows()));
                }
                // Generating a random x, y pair and inserting it so rows are sorted.
                var x = Math.floor(Math.random() * 10000);
                var y = Math.floor(Math.random() * 1000);
                var row = 0;
                while (row < data.getNumberOfRows() && parseInt(data.getValue(row, 0)) < x) {
                    row++;
                }
                data.insertRows(row, [[x.toString(), y]]);
                chart.draw(data, options);
            }

        }

        google.load("visualization", "1", {packages:["corechart"]});
        google.setOnLoadCallback(drawChart);

    </script>

</dom-module>
